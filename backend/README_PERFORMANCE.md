# Kubernetes环境下支持1.5k并发的性能优化指南

## 优化内容

为了在Kubernetes环境中让系统能够稳定支持1.5k并发，我们对以下配置进行了优化：

### 1. 数据库连接池优化
- **原始值**: 20
- **优化后**: 200
- **修改文件**: `src/config/configuration.ts`, `.env.example`
- **目的**: 增加数据库并发处理能力

### 2. Redis连接池优化
- **原始值**: 50
- **优化后**: 100
- **修改文件**: `src/config/performance.config.ts`
- **目的**: 提高缓存处理并发请求的能力

### 3. 限流配置优化
- **全局限流**：从1000增加到10000
- **API限流**：从100增加到5000
- **认证接口限流**：从10增加到500
- **修改文件**: `src/config/performance.config.ts`, `src/config/configuration.ts`, `.env.example`
- **目的**: 允许系统处理更多并发请求

### 4. 集群配置优化
- **修改内容**: 始终启用集群模式，确保至少有2个工作进程
- **修改文件**: `src/config/performance.config.ts`
- **目的**: 充分利用服务器多核CPU能力

## 实施步骤

### 1. 修改环境变量（推荐）

复制 `.env.example` 到 `.env` 并更新以下配置：

```env
# 数据库配置
DB_POOL_SIZE=200

# 限流配置
THROTTLER_LIMIT=5000
```

### 2. 直接修改配置文件（备选）

如果不使用环境变量，可以直接修改 `src/config/configuration.ts` 文件中的默认值。

## 验证方法

使用提供的性能测试脚本验证优化效果：

```bash
npm run test:performance
```

## 注意事项

1. 请确保您的服务器有足够的内存和CPU资源
2. 优化后的配置可能会增加系统资源消耗
3. 建议在生产环境前进行充分的压力测试
4. 如果遇到问题，可以根据实际情况调整参数值

---

作者：AI助手
时间：2025-09-26 18:27:00