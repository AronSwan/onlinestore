# ================================
# 🏪 Caddy Style Shopping - 主配置文件
# ================================
# 用途：统一的环境配置文件，支持所有环境和功能
# 作者：后端开发团队
# 版本：v2.0.0
# 更新：2025-10-05

# ================================
# 🌍 环境配置
# ================================
NODE_ENV=production
PORT=3000
API_PREFIX=api
APP_NAME=caddy-style-shopping-backend
APP_VERSION=1.0.0

# ================================
# 🗄️ 数据库配置 (TiDB/MySQL/SQLite)
# ================================
# 主数据库配置
DB_TYPE=sqlite
DB_HOST=localhost
DB_PORT=4000
DB_USERNAME=root
DB_PASSWORD=
DB_DATABASE=./data/caddy_shopping.db
DB_CHARSET=utf8mb4
DB_TIMEZONE=+08:00
DB_SSL=false
DB_SYNCHRONIZE=false
DB_LOGGING=true

# 连接池配置
DB_POOL_SIZE=20
DB_MAX_CONNECTIONS=20
DB_MIN_CONNECTIONS=5
DB_CONNECTION_TIMEOUT=60000
DB_ACQUIRE_TIMEOUT=60000
DB_IDLE_TIMEOUT=300000

# TiDB 集群配置（生产环境）
TIDB_CLUSTER_NAME=local-tidb
TIDB_PD_ENDPOINTS=127.0.0.1:2379
TIDB_TIKV_ENDPOINTS=127.0.0.1:20160
TIDB_TIDB_ENDPOINTS=127.0.0.1:4000
TIDB_NODES=127.0.0.1:4000,127.0.0.1:4001
PD_ENDPOINTS=127.0.0.1:2379,127.0.0.1:2380,127.0.0.1:2381
TIDB_DASHBOARD_URL=http://127.0.0.1:2379/dashboard

# ================================
# 🔴 Redis 配置
# ================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=caddy:
REDIS_TTL=3600
REDIS_POOL_SIZE=10
REDIS_CONNECT_TIMEOUT=10000
REDIS_COMMAND_TIMEOUT=5000
REDIS_TLS=false

# 购物车 Redis 配置
CART_REDIS_DB=1
CART_CACHE_REDIS_DB=2
CART_CACHE_TTL=3600
CART_LOCK_TIMEOUT=30000
CART_LOCK_RETRY_DELAY=100
CART_LOCK_RETRY_COUNT=10

# ================================
# 🔐 JWT 安全配置
# ================================
JWT_SECRET=SuperS3cr3t_Jwt_K3y_w1th_C0mpl3x_Ch@r$_2024_D3v_Env_Secure_64_Chars
JWT_ALGORITHM=HS256
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d
JWT_ISSUER=caddy-shopping-api
JWT_AUDIENCE=caddy-shopping-client

# RSA 密钥配置（高级安全）
JWT_PRIVATE_KEY=
JWT_PUBLIC_KEY=
JWT_KEY_SIZE=2048
JWT_KEY_FORMAT=pkcs8
JWT_PUBLIC_KEY_FORMAT=spki

# ================================
# 🛡️ 安全配置
# ================================
# 加密配置
ENCRYPTION_KEY=a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456
ENCRYPTION_ALGORITHM=aes-256-gcm
ENCRYPTION_KEY_LENGTH=32
ENCRYPTION_IV_LENGTH=12
ENCRYPTION_TAG_LENGTH=16

# 支付安全
PAYMENT_SIGNATURE_SECRET=payment_signature_secret_key_for_hmac_validation_security_2024
PAYMENT_MAX_AMOUNT=1000000
PAYMENT_MAX_RETRY_COUNT=3
PAYMENT_CALLBACK_TIMEOUT_MINUTES=15
PAYMENT_NONCE_EXPIRY_MINUTES=15

# CORS 配置
CORS_ORIGINS=http://localhost:3000,http://localhost:5173,http://127.0.0.1:3000
CORS_CREDENTIALS=true
ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000,http://localhost:5173

# ================================
# 🚦 限流配置
# ================================
THROTTLER_TTL=60
THROTTLER_LIMIT=100

# 支付限流
PAYMENT_RATE_LIMIT_CREATE_TTL=60
PAYMENT_RATE_LIMIT_CREATE_LIMIT=10
PAYMENT_RATE_LIMIT_CALLBACK_TTL=60
PAYMENT_RATE_LIMIT_CALLBACK_LIMIT=100
PAYMENT_RATE_LIMIT_QUERY_TTL=60
PAYMENT_RATE_LIMIT_QUERY_LIMIT=60

# ================================
# 📝 日志配置
# ================================
LOG_LEVEL=debug
LOG_FILE=./logs/app.log
LOG_FILE_PATH=./logs
LOG_FORMAT=json
LOG_MASK_SENSITIVE_FIELDS=password,secret,token,key,signature,cardNumber,cvv,pin,privateKey,apiKey,accessToken,refreshToken
LOG_MASK_CHAR=*
LOG_MASK_VISIBLE_CHARS=4

# 审计日志
AUDIT_LOG_ENABLED=true
AUDIT_LOG_FILE=./logs/audit.log
AUDIT_LOG_LEVEL=info

# ================================
# 📊 监控配置
# ================================
METRICS_ENABLED=true
HEALTH_CHECK_ENABLED=true
TRACING_ENABLED=true
GRAFANA_URL=http://127.0.0.1:3000

# 安全监控
SECURITY_MONITORING_ENABLED=true
SECURITY_ALERT_THRESHOLD=5
SECURITY_LOG_RETENTION_DAYS=30

# ================================
# 📁 文件上传配置
# ================================
UPLOAD_DEST=./uploads
MAX_FILE_SIZE=10485760
REQUEST_MAX_PAYLOAD_SIZE=10mb

# 云存储配置（生产环境）
UPLOAD_PROVIDER=local
AWS_S3_BUCKET=
AWS_S3_REGION=
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# ================================
# 📧 邮件配置
# ================================
MAIL_HOST=smtp.example.com
MAIL_PORT=587
MAIL_USER=noreply@example.com
MAIL_PASS=your_mail_password
MAIL_FROM=noreply@caddy-shopping.com
MAIL_PROVIDER=smtp

# SendGrid 配置（生产环境）
SENDGRID_API_KEY=

# ================================
# 📱 消息队列配置 (Redpanda/Kafka)
# ================================
REDPANDA_BROKERS=localhost:9092
REDPANDA_CLIENT_ID=caddy-shopping-backend
REDPANDA_GROUP_ID=caddy-shopping-group

# ================================
# 🔍 搜索配置
# ================================
SEARCH_PROVIDER=local
MEILISEARCH_HOST=
MEILISEARCH_API_KEY=

# ================================
# 🌐 国际化配置
# ================================
DEFAULT_TIMEZONE=Asia/Shanghai
SUPPORTED_LOCALES=zh,en,ja,ko,es,fr,de
DEFAULT_LOCALE=zh

# ================================
# 🛡️ 安全防护配置
# ================================
# SSRF 防护
SSRF_ALLOWED_DOMAINS=example.com,localhost,127.0.0.1
SSRF_BLOCK_PRIVATE_IPS=true

# 密码字段排除
PASSWORD_EXCLUDE_FIELDS=password,oldPassword,newPassword,confirmPassword
RESPONSE_EXCLUDE_FIELDS=password,oldPassword,newPassword,confirmPassword,token,refreshToken

# CSRF 防护
CSRF_COOKIE_NAME=csrf-token

# 安全检查
SECURITY_CHECK_ENABLED=true
SECURITY_CHECK_FAIL_ON_HIGH=true
SECURITY_CHECK_SCAN_TIMEOUT=300000
SECURITY_CHECK_CACHE_ENABLED=true
SECURITY_CHECK_CACHE_DIR=.security-cache

# ================================
# 🧪 测试环境覆盖 (当 NODE_ENV=test 时生效)
# ================================
TEST_DB_DATABASE=./data/test_caddy_shopping.db
TEST_REDIS_DB=15
TEST_JWT_SECRET=test-jwt-secret-key-for-testing-only-32-chars
TEST_LOG_LEVEL=error
TEST_METRICS_ENABLED=false
TEST_UPLOAD_DEST=./test-uploads
TEST_MAX_FILE_SIZE=1048576

# ================================
# 🚀 生产环境覆盖 (当 NODE_ENV=production 时生效)
# ================================
PROD_LOG_LEVEL=info
PROD_LOG_FORMAT=json
PROD_METRICS_ENABLED=true
PROD_TRACING_ENABLED=true
PROD_DB_LOGGING=false
PROD_DB_SYNCHRONIZE=false