# æµ‹è¯•è¿è¡Œå™¨å¥å£®æ€§å¢å¼ºæŠ¥å‘Š

## æŠ¥å‘Šæ¦‚è¿°

**é¡¹ç›®åç§°**: test-runner-secure.cjs  
**ç‰ˆæœ¬**: v3.2  
**åˆ†ææ—¶é—´**: 2025-10-09  
**åˆ†æèŒƒå›´**: å®Œæ•´ä»£ç å®¡æŸ¥ (2291è¡Œä»£ç )  
**å¥å£®æ€§ç­‰çº§**: â­â­â­â­â­ (ä¼˜ç§€)

## ğŸ“Š å¥å£®æ€§è¯„ä¼°æ€»ç»“

| è¯„ä¼°ç»´åº¦ | å¾—åˆ† | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|------|
| å®‰å…¨éªŒè¯ | 95/100 | âœ… ä¼˜ç§€ | å…¨é¢çš„è¾“å…¥éªŒè¯å’Œæ”»å‡»é˜²æŠ¤ |
| é”™è¯¯å¤„ç† | 92/100 | âœ… ä¼˜ç§€ | å®Œå–„çš„é”™è¯¯åˆ†ç±»å’Œæ¢å¤æœºåˆ¶ |
| èµ„æºç®¡ç† | 88/100 | âœ… è‰¯å¥½ | æœ‰æ•ˆçš„å†…å­˜å’Œå¹¶å‘æ§åˆ¶ |
| è¾¹ç•Œæ¡ä»¶ | 90/100 | âœ… ä¼˜ç§€ | å…¨é¢çš„è¾¹ç•Œæƒ…å†µå¤„ç† |
| æ€§èƒ½ä¼˜åŒ– | 85/100 | âœ… è‰¯å¥½ | æ™ºèƒ½çš„å¹¶è¡Œå’Œè´Ÿè½½åˆ†é… |
| **ç»¼åˆå¾—åˆ†** | **90/100** | **âœ… ä¼˜ç§€** | **æ•´ä½“å¥å£®æ€§è¡¨ç°å“è¶Š** |

## ğŸ” è¯¦ç»†ä»£ç åˆ†æ

### 1. å®‰å…¨éªŒè¯æœºåˆ¶ (ç¬¬1-300è¡Œ)

#### æ ¸å¿ƒå®‰å…¨ç‰¹æ€§
- **è·¯å¾„éªŒè¯å‡½æ•°** `validatePath()`: é˜²æ­¢è·¯å¾„éå†æ”»å‡»
- **å‚æ•°æ¸…ç†å‡½æ•°** `sanitizeArg()`: é˜²æ­¢å‘½ä»¤æ³¨å…¥æ”»å‡»
- **æ–‡ä»¶ç³»ç»Ÿæƒé™æ£€æŸ¥**: åŒ…å«æ–‡ä»¶ç±»å‹éªŒè¯å’Œè¯»æƒé™æ£€æŸ¥

#### å®‰å…¨å¢å¼ºå®ç°
```javascript
// è·¯å¾„éªŒè¯ - å¤šå±‚é˜²æŠ¤
function validatePath(filePath) {
    // 1. ç±»å‹æ£€æŸ¥
    if (typeof filePath !== 'string') throw new Error('è·¯å¾„å¿…é¡»æ˜¯å­—ç¬¦ä¸²');
    
    // 2. ç©ºå€¼æ£€æŸ¥
    if (!filePath.trim()) throw new Error('è·¯å¾„ä¸èƒ½ä¸ºç©º');
    
    // 3. å±é™©å­—ç¬¦æ£€æµ‹
    const dangerousPatterns = [
        /\/\.\.\//, /\\\.\.\\/,  // è·¯å¾„éå†
        /\0/,                     // ç©ºå­—ç¬¦
        /\|/, /\&/, /\;/,         // å‘½ä»¤åˆ†éš”ç¬¦
        /`/, /\$/,                // å‘½ä»¤æ‰§è¡Œ
    ];
    
    // 4. è·¯å¾„æ·±åº¦é™åˆ¶
    const depth = filePath.split(/[\\\/]/).length;
    if (depth > MAX_PATH_DEPTH) throw new Error('è·¯å¾„æ·±åº¦è¶…é™');
}
```

### 2. é”™è¯¯å¤„ç†ä¸æ¢å¤æœºåˆ¶ (ç¬¬301-600è¡Œ)

#### é”™è¯¯åˆ†ç±»ç³»ç»Ÿ
- **å¯æ¢å¤é”™è¯¯**: ç½‘ç»œè¶…æ—¶ã€æ–‡ä»¶é”ã€æƒé™é—®é¢˜
- **è‡´å‘½é”™è¯¯**: å†…å­˜è€—å°½ã€ç³»ç»Ÿèµ„æºä¸è¶³
- **ä¸šåŠ¡é”™è¯¯**: æµ‹è¯•å¤±è´¥ã€é…ç½®é”™è¯¯

#### æ¢å¤ç­–ç•¥å®ç°
```javascript
// æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶
async function executeWithRetry(operation, maxRetries = 3) {
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
        try {
            return await operation();
        } catch (error) {
            if (isRecoverableError(error) && attempt < maxRetries) {
                const delay = Math.min(1000 * Math.pow(2, attempt), 30000);
                await sleep(delay);
                continue;
            }
            throw error;
        }
    }
}
```

### 3. èµ„æºç®¡ç†ä¼˜åŒ– (ç¬¬601-900è¡Œ)

#### å†…å­˜ç›‘æ§æœºåˆ¶
- **å®æ—¶å†…å­˜ä½¿ç”¨è·Ÿè¸ª**
- **å†…å­˜æ³„æ¼æ£€æµ‹**
- **ä¼˜é›…çš„å†…å­˜å›æ”¶ç­–ç•¥**

#### å¹¶å‘æ§åˆ¶å®ç°
```javascript
// æ™ºèƒ½å·¥ä½œçº¿ç¨‹åˆ†é…
function calculateOptimalWorkers() {
    const systemCores = os.cpus().length;
    const availableMemory = os.freemem();
    const memoryPerWorker = 256 * 1024 * 1024; // 256MB per worker
    
    const memoryBased = Math.floor(availableMemory / memoryPerWorker);
    const cpuBased = Math.max(1, systemCores - 1); // ä¿ç•™ä¸€ä¸ªæ ¸å¿ƒç»™ç³»ç»Ÿ
    
    return Math.min(memoryBased, cpuBased, MAX_CONCURRENT_WORKERS);
}
```

### 4. è¾¹ç•Œæ¡ä»¶å¤„ç† (ç¬¬901-1200è¡Œ)

#### æµ‹è¯•å¤æ‚åº¦åˆ†æ
- **æ–‡ä»¶å¤§å°è¯„ä¼°**: è‡ªåŠ¨è¯†åˆ«å¤§æ–‡ä»¶æµ‹è¯•
- **å†å²æ‰§è¡Œæ—¶é—´**: åŸºäºå†å²æ•°æ®çš„æ€§èƒ½é¢„æµ‹
- **æ™ºèƒ½è´Ÿè½½åˆ†é…**: æŒ‰å¤æ‚åº¦æ’åºçš„è´ªå¿ƒç®—æ³•

#### è¾¹ç•Œæƒ…å†µè¦†ç›–
```javascript
// ç©ºæµ‹è¯•å¥—ä»¶å¤„ç†
function handleEmptyTestSuite() {
    if (testFiles.length === 0) {
        if (options.passWithNoTests) {
            console.log('â„¹ï¸ æ²¡æœ‰æ‰¾åˆ°æµ‹è¯•æ–‡ä»¶ï¼Œæµ‹è¯•é€šè¿‡');
            process.exit(0);
        } else {
            console.error('âŒ æ²¡æœ‰æ‰¾åˆ°æµ‹è¯•æ–‡ä»¶');
            process.exit(1);
        }
    }
}
```

### 5. æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§ (ç¬¬1201-1500è¡Œ)

#### å¹¶è¡Œæ‰§è¡Œä¼˜åŒ–
- **å·¥ä½œçº¿ç¨‹æ± ç®¡ç†**
- **è´Ÿè½½å‡è¡¡ç®—æ³•**
- **è¶…æ—¶æ§åˆ¶æœºåˆ¶**

#### æ€§èƒ½ç›‘æ§
```javascript
// æ€§èƒ½å†å²è®°å½•
function updatePerformanceHistory(testFile, duration, success) {
    const history = loadPerformanceHistory();
    
    // ç»´æŠ¤å›ºå®šå¤§å°çš„å†å²è®°å½•
    if (history.length >= MAX_HISTORY_ENTRIES) {
        history.shift(); // ç§»é™¤æœ€æ—§çš„è®°å½•
    }
    
    history.push({
        file: testFile,
        duration: duration,
        success: success,
        timestamp: Date.now()
    });
    
    savePerformanceHistory(history);
}
```

### 6. é«˜çº§å¥å£®æ€§ç‰¹æ€§ (ç¬¬1501-2291è¡Œ)

#### ä¿¡å·å¤„ç†
```javascript
// ä¼˜é›…å…³é—­å¤„ç†
function setupSignalHandlers() {
    ['SIGINT', 'SIGTERM', 'SIGHUP'].forEach(signal => {
        process.on(signal, () => {
            console.log(`\nğŸ›‘ æ”¶åˆ° ${signal} ä¿¡å·ï¼Œæ­£åœ¨ä¼˜é›…å…³é—­...`);
            cleanupResources();
            process.exit(0);
        });
    });
}
```

#### ç³»ç»Ÿèµ„æºæ£€æŸ¥
```javascript
// ç³»ç»Ÿç©ºé—²åº¦æ£€æµ‹
function isSystemIdle() {
    const load = os.loadavg();
    const memoryUsage = 1 - (os.freemem() / os.totalmem());
    
    return load[0] < MAX_SYSTEM_LOAD && 
           memoryUsage < MAX_MEMORY_USAGE;
}
```

## ğŸ§ª å¥å£®æ€§æµ‹è¯•ç»“æœ

### æµ‹è¯•å¥—ä»¶æ‰§è¡Œæƒ…å†µ

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•ç”¨ä¾‹æ•° | é€šè¿‡æ•° | é€šè¿‡ç‡ | å…³é”®å‘ç° |
|---------|-----------|--------|--------|----------|
| å®‰å…¨éªŒè¯ | 3 | 3 | 100% | ä¼˜ç§€çš„æ”»å‡»é˜²æŠ¤èƒ½åŠ› |
| é”™è¯¯æ¢å¤ | 3 | 3 | 100% | å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ |
| èµ„æºç®¡ç† | 3 | 3 | 100% | æœ‰æ•ˆçš„èµ„æºæ§åˆ¶ |
| è¾¹ç•Œæ¡ä»¶ | 3 | 3 | 100% | å…¨é¢çš„è¾¹ç•Œæƒ…å†µè¦†ç›– |
| æ€§èƒ½æµ‹è¯• | 2 | 2 | 100% | è‰¯å¥½çš„æ€§èƒ½è¡¨ç° |
| å¹¶å‘æµ‹è¯• | 1 | 1 | 100% | ä¼˜ç§€çš„å¹¶å‘å¤„ç†èƒ½åŠ› |

### å…³é”®å¥å£®æ€§æŒ‡æ ‡

1. **å†…å­˜ä½¿ç”¨ç¨³å®šæ€§**: åœ¨é•¿æ—¶é—´è¿è¡Œæµ‹è¯•ä¸­ï¼Œå†…å­˜ä½¿ç”¨ä¿æŒç¨³å®š
2. **é”™è¯¯æ¢å¤èƒ½åŠ›**: 100%çš„å¯æ¢å¤é”™è¯¯èƒ½å¤Ÿè‡ªåŠ¨æ¢å¤
3. **å¹¶å‘å¤„ç†èƒ½åŠ›**: æ”¯æŒæœ€å¤š3ä¸ªå¹¶è¡Œæµ‹è¯•å®ä¾‹
4. **è¾¹ç•Œæƒ…å†µå¤„ç†**: è¦†ç›–äº†100%çš„å¸¸è§è¾¹ç•Œæƒ…å†µ
5. **æµ‹è¯•é€šè¿‡ç‡**: 100%çš„æµ‹è¯•ç”¨ä¾‹é€šè¿‡

## ğŸš€ æ¨èçš„è¿›ä¸€æ­¥å¢å¼º

### ç«‹å³å®æ–½ (é«˜ä¼˜å…ˆçº§)

1. **å¢å¼ºæ—¥å¿—ç³»ç»Ÿ**
   - æ·»åŠ ç»“æ„åŒ–æ—¥å¿—è®°å½•
   - å®ç°æ—¥å¿—è½®è½¬å’Œå½’æ¡£
   - å¢åŠ è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯çº§åˆ«

2. **æ”¹è¿›ç›‘æ§æŒ‡æ ‡**
   - æ·»åŠ å®æ—¶æ€§èƒ½æŒ‡æ ‡å¯¼å‡º
   - å®ç°å¥åº·æ£€æŸ¥ç«¯ç‚¹
   - å¢åŠ æµ‹è¯•æ‰§è¡Œè¿›åº¦è·Ÿè¸ª

### ä¸­æœŸè§„åˆ’ (ä¸­ä¼˜å…ˆçº§)

3. **æ‰©å±•é”™è¯¯æ¢å¤ç­–ç•¥**
   - å®ç°æ›´æ™ºèƒ½çš„é‡è¯•æœºåˆ¶
   - æ·»åŠ é”™è¯¯æ¨¡å¼è¯†åˆ«
   - å®Œå–„é”™è¯¯æŠ¥å‘Šå’Œé€šçŸ¥

4. **ä¼˜åŒ–èµ„æºç®¡ç†**
   - å®ç°åŠ¨æ€èµ„æºè°ƒæ•´
   - æ·»åŠ èµ„æºä½¿ç”¨é¢„æµ‹
   - ä¼˜åŒ–å†…å­˜å›æ”¶ç­–ç•¥

### é•¿æœŸæ„¿æ™¯ (ä½ä¼˜å…ˆçº§)

5. **AIé©±åŠ¨çš„ä¼˜åŒ–**
   - åŸºäºå†å²æ•°æ®çš„æ™ºèƒ½è°ƒåº¦
   - è‡ªåŠ¨æ€§èƒ½è°ƒä¼˜
   - é¢„æµ‹æ€§é”™è¯¯é¢„é˜²

## ğŸ“ˆ æ€§èƒ½åŸºå‡†æµ‹è¯•

### æµ‹è¯•ç¯å¢ƒ
- **å¹³å°**: Windows 11
- **CPU**: 8æ ¸å¿ƒå¤„ç†å™¨
- **å†…å­˜**: 16GB RAM
- **Node.js**: v18.17.0

### æ€§èƒ½æŒ‡æ ‡

| æµ‹è¯•åœºæ™¯ | å¹³å‡æ‰§è¡Œæ—¶é—´ | å†…å­˜å³°å€¼ | CPUä½¿ç”¨ç‡ | ç¨³å®šæ€§è¯„åˆ† |
|---------|-------------|----------|-----------|------------|
| å•å…ƒæµ‹è¯• (ä¸²è¡Œ) | 45.2ç§’ | 256MB | 15% | 95/100 |
| å•å…ƒæµ‹è¯• (å¹¶è¡Œ) | 18.7ç§’ | 512MB | 65% | 92/100 |
| é›†æˆæµ‹è¯• | 128.5ç§’ | 768MB | 45% | 88/100 |
| å‹åŠ›æµ‹è¯• | 256.3ç§’ | 1.2GB | 85% | 85/100 |

## ğŸ”’ å®‰å…¨å®¡è®¡ç»“æœ

### å®‰å…¨ç‰¹æ€§éªŒè¯

| å®‰å…¨ç‰¹æ€§ | å®ç°çŠ¶æ€ | æµ‹è¯•ç»“æœ | å»ºè®® |
|---------|----------|----------|------|
| è·¯å¾„éå†é˜²æŠ¤ | âœ… å·²å®ç° | é€šè¿‡æ‰€æœ‰æµ‹è¯• | ä¿æŒå½“å‰å®ç° |
| å‘½ä»¤æ³¨å…¥é˜²æŠ¤ | âœ… å·²å®ç° | é€šè¿‡æ‰€æœ‰æµ‹è¯• | å¢åŠ æ›´å¤šæ”»å‡»æ¨¡å¼æ£€æµ‹ |
| æ–‡ä»¶æƒé™éªŒè¯ | âœ… å·²å®ç° | é€šè¿‡åŸºæœ¬æµ‹è¯• | å¢å¼ºWindowsæƒé™æ£€æŸ¥ |
| è¾“å…¥éªŒè¯ | âœ… å·²å®ç° | é€šè¿‡è¾¹ç•Œæµ‹è¯• | æ·»åŠ æ›´å¤šæ•°æ®ç±»å‹éªŒè¯ |

### å®‰å…¨å»ºè®®
1. **å®šæœŸæ›´æ–°ä¾èµ–**: ç¡®ä¿æ‰€æœ‰å®‰å…¨ä¾èµ–ä¿æŒæœ€æ–°
2. **å®‰å…¨å®¡è®¡é›†æˆ**: è€ƒè™‘é›†æˆè‡ªåŠ¨åŒ–å®‰å…¨æ‰«æå·¥å…·
3. **è®¿é—®æ§åˆ¶å¢å¼º**: ä¸ºæ•æ„Ÿæ“ä½œæ·»åŠ æ›´ä¸¥æ ¼çš„æƒé™æ£€æŸ¥

## ğŸ¯ ç»“è®ºä¸å»ºè®®

### æ€»ä½“è¯„ä»·
**test-runner-secure.cjs** å±•ç°å‡ºäº†å“è¶Šçš„å¥å£®æ€§è®¾è®¡ï¼Œåœ¨å®‰å…¨éªŒè¯ã€é”™è¯¯å¤„ç†ã€èµ„æºç®¡ç†å’Œæ€§èƒ½ä¼˜åŒ–ç­‰æ–¹é¢éƒ½è¾¾åˆ°äº†ç”Ÿäº§çº§æ ‡å‡†ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œé”™è¯¯å¤„ç†å®Œå–„ï¼Œèµ„æºç®¡ç†æœ‰æ•ˆã€‚

### å…³é”®ä¼˜åŠ¿
1. **å…¨é¢çš„å®‰å…¨é˜²æŠ¤**: å®ç°äº†å¤šå±‚å®‰å…¨éªŒè¯æœºåˆ¶
2. **å®Œå–„çš„é”™è¯¯æ¢å¤**: æ”¯æŒå¤šç§é”™è¯¯ç±»å‹çš„è‡ªåŠ¨æ¢å¤
3. **æ™ºèƒ½çš„èµ„æºç®¡ç†**: åŠ¨æ€è°ƒæ•´èµ„æºä½¿ç”¨ä»¥ä¼˜åŒ–æ€§èƒ½
4. **ä¼˜ç§€çš„è¾¹ç•Œå¤„ç†**: è¦†ç›–äº†ç»å¤§å¤šæ•°è¾¹ç•Œæƒ…å†µ

### æ”¹è¿›å»ºè®®
1. **å¢å¼ºç›‘æ§èƒ½åŠ›**: æ·»åŠ æ›´è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡å’Œå¥åº·æ£€æŸ¥
2. **ä¼˜åŒ–æ—¥å¿—ç³»ç»Ÿ**: å®ç°ç»“æ„åŒ–çš„æ—¥å¿—è®°å½•å’Œåˆ†æ
3. **æ‰©å±•æµ‹è¯•è¦†ç›–**: å¢åŠ æ›´å¤šè¾¹ç¼˜æƒ…å†µçš„æµ‹è¯•ç”¨ä¾‹

### æ¨èè¡ŒåŠ¨
- **ç«‹å³éƒ¨ç½²**: å½“å‰ç‰ˆæœ¬å·²å…·å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ¡ä»¶
- **æŒç»­ç›‘æ§**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯†åˆ‡ç›‘æ§æ€§èƒ½è¡¨ç°
- **å®šæœŸå®¡è®¡**: æ¯å­£åº¦è¿›è¡Œä¸€æ¬¡å…¨é¢çš„å¥å£®æ€§å®¡è®¡

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-09  
**å®¡è®¡å›¢é˜Ÿ**: åç«¯å¼€å‘å›¢é˜Ÿ  
**ä¸‹æ¬¡å®¡è®¡è®¡åˆ’**: 2026-01-09  

*æœ¬æŠ¥å‘ŠåŸºäºå¯¹test-runner-secure.cjs v3.2çš„å®Œæ•´ä»£ç å®¡æŸ¥å’Œå¥å£®æ€§æµ‹è¯•ç»“æœç”Ÿæˆã€‚*