<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>嵌入式数据测试</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e6ed;
        }
        
        .header h1 {
            margin: 0;
            color: #2c3e50;
        }
        
        .header .last-updated {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #7f8c8d;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            margin: 0;
        }
        
        .stat-card.critical .value {
            color: #e74c3c;
        }
        
        .stat-card.high .value {
            color: #e67e22;
        }
        
        .stat-card.medium .value {
            color: #f39c12;
        }
        
        .stat-card.low .value {
            color: #27ae60;
        }
        
        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            height: 400px;
        }
        
        .vulnerability-table {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #e0e6ed;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .severity-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .severity-badge.critical {
            background-color: #e74c3c;
            color: white;
        }
        
        .severity-badge.high {
            background-color: #e67e22;
            color: white;
        }
        
        .severity-badge.medium {
            background-color: #f39c12;
            color: white;
        }
        
        .severity-badge.low {
            background-color: #27ae60;
            color: white;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-badge.open {
            background-color: #e74c3c;
            color: white;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>安全仪表板（嵌入式数据）</h1>
            <div class="last-updated">最后更新: <span id="lastUpdated"></span></div>
        </div>
        
        <div class="stats-container">
            <div class="stat-card critical">
                <h3>严重漏洞</h3>
                <p class="value" id="criticalCount">0</p>
            </div>
            <div class="stat-card high">
                <h3>高危漏洞</h3>
                <p class="value" id="highCount">0</p>
            </div>
            <div class="stat-card medium">
                <h3>中危漏洞</h3>
                <p class="value" id="mediumCount">0</p>
            </div>
            <div class="stat-card low">
                <h3>低危漏洞</h3>
                <p class="value" id="lowCount">0</p>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="distributionChart"></canvas>
        </div>
        
        <div class="vulnerability-table">
            <h3>漏洞列表</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>标题</th>
                        <th>严重度</th>
                        <th>状态</th>
                        <th>负责人</th>
                        <th>发现日期</th>
                    </tr>
                </thead>
                <tbody id="vulnerabilityTableBody">
                    <!-- 表格内容将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // 嵌入漏洞数据
        const vulnerabilityData = {
            metadata: {
                version: "1.0",
                lastUpdated: "2025-10-03",
                maintainer: "安全团队"
            },
            vulnerabilities: [
                {
                    id: "VULN-001",
                    title: "JWT认证守卫实现过于简单",
                    severity: "高",
                    status: "待修复",
                    owner: "张三",
                    firstFound: "2025-10-02"
                },
                {
                    id: "VULN-002",
                    title: "角色守卫实现存在逻辑错误",
                    severity: "高",
                    status: "待修复",
                    owner: "李四",
                    firstFound: "2025-10-02"
                },
                {
                    id: "VULN-003",
                    title: "支付控制器缺乏严格输入验证",
                    severity: "严重",
                    status: "待修复",
                    owner: "王五",
                    firstFound: "2025-10-02"
                },
                {
                    id: "VULN-004",
                    title: "地址控制器缺乏输入长度限制",
                    severity: "中",
                    status: "待修复",
                    owner: "赵六",
                    firstFound: "2025-10-02"
                },
                {
                    id: "VULN-005",
                    title: "用户实体密码字段处理不当",
                    severity: "中",
                    status: "待修复",
                    owner: "钱七",
                    firstFound: "2025-10-02"
                },
                {
                    id: "VULN-006",
                    title: "订单实体缺乏数据库索引",
                    severity: "低",
                    status: "待修复",
                    owner: "孙八",
                    firstFound: "2025-10-02"
                },
                {
                    id: "VULN-007",
                    title: "支付服务中存在竞态条件",
                    severity: "高",
                    status: "待修复",
                    owner: "周九",
                    firstFound: "2025-10-02"
                },
                {
                    id: "VULN-008",
                    title: "订单服务中库存更新缺乏原子性",
                    severity: "高",
                    status: "待修复",
                    owner: "吴十",
                    firstFound: "2025-10-02"
                }
            ]
        };
        
        // 处理数据
        function processData() {
            // 统计各严重级别的漏洞数量
            const critical = vulnerabilityData.vulnerabilities.filter(v => v.severity === '严重').length;
            const high = vulnerabilityData.vulnerabilities.filter(v => v.severity === '高').length;
            const medium = vulnerabilityData.vulnerabilities.filter(v => v.severity === '中').length;
            const low = vulnerabilityData.vulnerabilities.filter(v => v.severity === '低').length;
            
            // 更新统计卡片
            document.getElementById('criticalCount').textContent = critical;
            document.getElementById('highCount').textContent = high;
            document.getElementById('mediumCount').textContent = medium;
            document.getElementById('lowCount').textContent = low;
            
            // 更新最后更新时间
            document.getElementById('lastUpdated').textContent = vulnerabilityData.metadata.lastUpdated;
            
            // 创建分布图表
            createDistributionChart(critical, high, medium, low);
            
            // 填充漏洞表格
            populateVulnerabilityTable();
        }
        
        // 创建分布图表
        function createDistributionChart(critical, high, medium, low) {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['严重', '高', '中', '低'],
                    datasets: [{
                        data: [critical, high, medium, low],
                        backgroundColor: [
                            '#e74c3c',
                            '#e67e22',
                            '#f39c12',
                            '#27ae60'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        title: {
                            display: true,
                            text: '漏洞分布'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 填充漏洞表格
        function populateVulnerabilityTable() {
            const tableBody = document.getElementById('vulnerabilityTableBody');
            tableBody.innerHTML = '';
            
            vulnerabilityData.vulnerabilities.forEach(vuln => {
                const row = document.createElement('tr');
                
                const severityClass = vuln.severity === '严重' ? 'critical' : 
                                     vuln.severity === '高' ? 'high' : 
                                     vuln.severity === '中' ? 'medium' : 'low';
                
                row.innerHTML = `
                    <td>${vuln.id}</td>
                    <td>${vuln.title}</td>
                    <td><span class="severity-badge ${severityClass}">${vuln.severity}</span></td>
                    <td><span class="status-badge open">${vuln.status}</span></td>
                    <td>${vuln.owner}</td>
                    <td>${vuln.firstFound}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // 页面加载完成后处理数据
        document.addEventListener('DOMContentLoaded', processData);
    </script>
</body>
</html>