# 重启后 TiDB 启动指南

## 🔄 重启系统
现在就可以重启 Windows 系统以完成 WSL2 安装。

## 🚀 重启后操作

### 1. 启动 WSL2 Ubuntu
```powershell
# 在 PowerShell 中执行
wsl -d Ubuntu
```

### 2. 执行自动化设置脚本
```bash
# 在 Ubuntu WSL2 中执行
bash /mnt/d/codes/onlinestore/caddy-style-shopping-site/backend/scripts/setup-tidb-after-reboot.sh
```

### 3. 验证 TiDB 连接
回到 Windows PowerShell：
```powershell
cd d:\codes\onlinestore\caddy-style-shopping-site\backend
npm run tidb:health
npm run migration:run
```

### 4. 检查后端状态
你的后端 dev 进程应该会自动连接到 TiDB 并停止重试错误。

## 📊 TiDB 集群信息
- **SQL 连接**: `mysql -h 127.0.0.1 -P 4000 -u root`
- **Dashboard**: http://127.0.0.1:2379/dashboard
- **Grafana**: http://127.0.0.1:3000 (用户名: admin, 密码: admin)

## 🔧 常用命令

### 查看 TiDB 状态
```bash
# 在 WSL2 Ubuntu 中
tiup playground display
```

### 查看 TiDB 日志
```bash
tail -f ~/tidb.log
```

### 停止 TiDB 集群
```bash
tiup playground stop
```

### 重启 TiDB 集群
```bash
tiup playground v7.5.0 --db 1 --pd 1 --kv 1 --host 0.0.0.0
```

## 🚨 故障排查

### 如果连接失败
1. 检查 TiDB 是否运行：`tiup playground display`
2. 检查端口是否监听：`netstat -tlnp | grep 4000`
3. 查看日志：`tail -20 ~/tidb.log`

### 如果后端仍然报错
1. 重启后端 dev 进程：Ctrl+C 后重新 `npm run start:dev`
2. 检查环境变量：确认 `.env` 文件中的数据库配置
3. 测试连接：`npm run tidb:health`

## ✅ 成功标志
- WSL2 Ubuntu 正常启动
- TiDB 集群运行在 4000 端口
- `npm run tidb:health` 返回 `{"status":"up"}`
- 后端 dev 进程不再报数据库连接错误
- 迁移成功执行

现在可以重启系统了！